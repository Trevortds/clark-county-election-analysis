<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-57XTP6ZX');</script>
    <!-- End Google Tag Manager -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2024 Early Voting in Clark County, NV - Reversed Tabulator History</title>
    <!-- Observable Plot loaded as ES module -->
    <script src="https://cdn.jsdelivr.net/npm/@observablehq/plot@0.6/+esm" type="module"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            border-radius: 5px;
        }
        h1 {
            text-align: center;
            background-color: #FFD700; /* Gold background for header */
            color: #000;
            padding: 15px;
            margin-top: 0;
            border-radius: 4px;
        }
        .description {
            margin: 20px 0;
            line-height: 1.5;
            color: #333;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }
        .controls {
            margin: 20px 0;
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        .plot-container {
            margin: 20px 0;
            display: flex;
            justify-content: center;
        }
        .footer {
            text-align: right;
            font-size: 0.8em;
            font-style: italic;
            margin-top: 20px;
            color: #666;
        }
        /* Loading indicator */
        #loading {
            text-align: center;
            padding: 20px;
            display: none;
        }
        /* Control group styling */
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .radio-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        input[type="radio"] {
            cursor: pointer;
        }
        .note {
            font-size: 0.8em;
            color: #777;
            margin-top: 4px;
        }
    </style>
    


</head>
<body>
    <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-57XTP6ZX"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <div class="container">
        <h1>2024 Early Voting in Clark County, NV - Vote Progression</h1>
        
        <div class="description">
            This visualization shows how vote percentages changed as votes were counted on each tabulator. 
            You can view the progression in either direction - from first vote to last (forward) or from last vote to first (reverse).
            Only tabulators with at least 250 total votes are included to focus on machines with significant voting history.
        </div>
    
        <div class="controls">
            <div class="control-group">
                <label>Color Mode:</label>
                <div class="radio-group">
                    <input type="radio" id="colorModeNone" name="colorMode" value="none">
                    <label for="colorModeNone">None (Rainbow)</label>
                    <input type="radio" id="colorModeBinary" name="colorMode" value="binary" checked>
                    <label for="colorModeBinary">Urban/Rural</label>
                    <input type="radio" id="colorModeGradient" name="colorMode" value="gradient">
                    <label for="colorModeGradient">Urban % Gradient</label>
                </div>
            </div>
            
            <div class="control-group">
                <span class="control-label">Line Count:</span>
                <div class="radio-group">
                    <label><input type="radio" name="lineCount" value="all"> All</label>
                    <label><input type="radio" name="lineCount" value="100"> 100</label>
                    <label><input type="radio" name="lineCount" value="50" checked> 50</label>
                    <label><input type="radio" name="lineCount" value="20"> 20</label>
                </div>
                <div class="disclaimer" style="font-size: 0.8em; color: #666; margin-top: 4px;">
                    <em>Note: The "All" option may take a long time to load and be difficult to read.</em>
                </div>
            </div>
            
            <div class="control-group">
                <label>Selection Method:</label>
                <div class="radio-group">
                    <input type="radio" id="selectionMethodLongest" name="selectionMethod" value="longest" checked>
                    <label for="selectionMethodLongest">Longest Vote History</label>
                    <input type="radio" id="selectionMethodRandom" name="selectionMethod" value="random">
                    <label for="selectionMethodRandom">Random Tabulators</label>
                </div>
            </div>
            
            <div class="control-group">
                <label>Time Direction:</label>
                <div class="radio-group">
                    <input type="radio" id="directionReverse" name="timeDirection" value="reverse" checked>
                    <label for="directionReverse">Reverse (Last → First)</label>
                    <input type="radio" id="directionForward" name="timeDirection" value="forward">
                    <label for="directionForward">Forward (First → Last)</label>
                </div>
            </div>
        </div>
        
        <!-- Visualization container -->
            <div id="loading">Loading data...</div>
            <div class="plot-container">
                <div id="reversedGameHistoryPlot"></div>
            </div>
        
            <div class="footer">
                Based on Clark County early voting election data
            </div>
    </div>
    
    <script type="module">
        import { createReversedGameHistoryPlot } from './src/reversed_game_history.js';
        
        // Show loading indicator
        document.getElementById('loading').style.display = 'block';
        
        // Fetch the data and create the plot
        fetch('data/processed_data/early_votes_scatter_data.json')
            .then(response => response.json())
            .then(scatterData => {
                // Hide loading indicator
                document.getElementById('loading').style.display = 'none';
                // Debug the data format
                console.log('Data type:', typeof scatterData);
                console.log('Is array:', Array.isArray(scatterData));
                console.log('Data preview:', scatterData ? scatterData.slice?.(0, 2) : scatterData);
                
                // Initialize the plot with the first data load
                updatePlot(scatterData);
                
                // Store the currently selected tabulators for random mode
                let selectedRandomTabulators = null;
                
                // Add event listeners for controls that should regenerate random selection
                document.querySelectorAll('input[name="colorMode"], input[name="lineCount"], input[name="selectionMethod"]')
                    .forEach(input => {
                        input.addEventListener('change', () => {
                            // Clear stored random tabulators when these controls change
                            selectedRandomTabulators = null;
                            updatePlot(scatterData, selectedRandomTabulators);
                        });
                    });
                
                // Add separate event listener for time direction to preserve random selection
                document.querySelectorAll('input[name="timeDirection"]')
                    .forEach(input => {
                        input.addEventListener('change', () => {
                            // Pass current random tabulators to preserve them
                            updatePlot(scatterData, selectedRandomTabulators);
                        });
                    });
                
                // Function to update selected random tabulators
                window.setSelectedRandomTabulators = (tabulators) => {
                    selectedRandomTabulators = tabulators;
                };
            })
            .catch(error => {
                // Hide loading indicator and show error
                document.getElementById('loading').style.display = 'none';
                console.error('Error loading data:', error);
                document.getElementById('reversedGameHistoryPlot').innerHTML = 
                    '<p style="color: red;">Error loading data. Please check the console for details.</p>';
            });
        
        function updatePlot(scatterData, selectedRandomTabulators = null) {
            // Get the selected options
            const colorMode = document.querySelector('input[name="colorMode"]:checked').value;
            const lineCount = document.querySelector('input[name="lineCount"]:checked').value;
            const selectionMethod = document.querySelector('input[name="selectionMethod"]:checked').value;
            const timeDirection = document.querySelector('input[name="timeDirection"]:checked').value;
            
            // Create the plot - note that scatter data has a .data property
            createReversedGameHistoryPlot('reversedGameHistoryPlot', scatterData.data, {
                colorMode,
                lineCount,
                selectionMethod,
                timeDirection,
                selectedRandomTabulators
            });
        }
    </script>
</body>
</html>
